# Bachelor's Thesis: Path Tracking Optimization with Model Predictive Control for Autonomous Racing in F1TENTH

This repository contains the project source code, LaTeX and PDF files for my bachelor's thesis of the Computer Science degree at "Universit√† degli Studi di Milano".

You can read:
- Thesis project on Model Predictive Control for Autonomous Racing ([PDF](https://github.com/Weinsz/Bachelor-Thesis-MPC/blob/main/thesis/thesis.pdf));
- Summary of the project ([PDF](https://github.com/Weinsz/Bachelor-Thesis-MPC/blob/main/summary/summary.pdf));
- Presentation used on the day of the thesis defense ([PDF](https://github.com/Weinsz/Bachelor-Thesis-MPC/blob/main/presentation/presentation.pdf)). Use [Powerpoint](https://github.com/Weinsz/Bachelor-Thesis-MPC/blob/main/presentation/presentation.pptx) for a higher quality.

## Goals
This thesis project aims to develop and analyze an optimized control system for the path tracking task with a single agent, applied to the field of Autonomous Racing for the F1TENTH platform. It involves the implementation and analysis of `Model Predictive Control (MPC)`, an optimal and predictive control algorithm, and furthermore, this system has been compared with `Pure Pursuit`, another control method that is conceptually simpler. 

Specifically, the objectives of the work include:
1. development of a functioning autonomous driving system related to a simulated vehicle of the F1TENTH category;
2. optimization of the calculated trajectory, reducing the tracking error as much as possible, i.e. the deviation compared to the theoretical reference line;
3. applicability in Formula 1 circuits on a scale reduced to 1:10. These racetracks are Spa-Francorchamps (Belgium) and Monza (Italy);
4. analysis of the results and the comparison of the performances with Pure Pursuit and between the different MPC profiles/configurations (`Safe`, `Fast` and `High Performance`).

Therefore, the ultimate goal is to understand if MPC represents a valid solution and if it's superior to a simpler reactive control method, as it performs purely geometric calculations to follow a trajectory generated by a planner.

## Tech stack

The thesis work involved the following technologies:
- [`ROS 2 Humble`](https://docs.ros.org/en/humble/index.html), for the management of the robotic infrastructure.
  
  Assuming everything is set up properly (ROS2 environment), the command to run MPC in the chosen F1TENTH's racetrack is:

  `build lab_mpc && ros2 launch lab_mpc mpc_<MAP_NAME>_<MPC_PROFILE>_launch.py`. For this thesis, `MAP_NAME` is `[Spa|Monza]`, and `MPC_PROFILE` is `[safe|fast|hp]`.
- [`F1TENTH Gym`](https://github.com/f1tenth/f1tenth_gym_ros), for circuit and vehicle simulation. However, the actual viewing of the simulator takes place on RViz;
- `Python`, as a language for implementing algorithms, and packages such as:
  - [`rclpy`](https://github.com/ros2/rclpy) for interaction with ROS 2; 
  - [`CVXPY`](https://www.cvxpy.org/), necessary for solving the convex optimization problem; 
  - `Jupyter Notebook`, instead, for analyzing the results.
 
[Steven Gong's site](https://stevengong.co/notes/F1TENTH), [F1TENTH course](https://ahmadamine998.github.io/6150-Spring2024-Website/lectures/) and this [repository](https://github.com/derekhanbaliq/f1tenth-software-stack) were fundamental for this work. They helped me to understand a lot of topics related to ROS2 building blocks and F1TENTH core concepts.
 
## Results obtained
The results obtained confirmed the excellent functionality of Model Predictive Control on both circuits tested, in line with the expectations and objectives set. 
In fact, an advanced control system has been obtained as it optimizes path tracking by using MPC: thanks to its predictive nature, this algorithm provides more precise trajectories, with tracking errors significantly lower than Pure Pursuit. 
In addition to this, lower lap times are also achieved for each MPC profile.

A further positive aspect that emerged from the comparison is the reduced energy consumption, a particularly relevant result given the reduced scale. Pure Pursuit consumes much more, but without offering the same performance and same advantages as MPC.
The `High Performance` configuration results as the best version of MPC, especially in an extreme racing scenario, guaranteeing superior performance in terms of speed too.

Possible evolutions of this project may include:
- Sim2Real transition;
- Data-driven or Neural Networks approaches for MPC;
- More complex dynamics models
- Head-to-head racing (2 or more agents)
